# 绪论

### 1. 操作系统

操作系统目标：

- 与硬件交互
- 为应用程序提供执行环境

操作系统通常会禁止程序与硬件进行直接交互，而是内核代表应用程序和硬件进行交互。机制实现：依靠现代CPU提供的两种执行模式：

- 用户程序非特权模式
- 内核特权模式

### 2. 多用户系统

一台能并发和独立执行多个用户的若干应用程序的计算机。特点：

- 用户身份认证机制
- 防止错误用户程序妨碍其他应用程序运行的保护机制
- 防止恶意用户程序干涉其他用户的保护机制
- 限制每个用户资源树的记账机制

### 3. 用户/组

- 用户标识符（UID）
- 用户组标识符（user group ID）

### 4. 进程

进程为程序执行时的一个实例，系统资源分配的最小单位，每个进程都有自己的独立地址空间、系统资源。

> 地址空间：允许进程引用的内存地址集合

多用户系统必须实现 允许进程并发活动，进程必须是抢占式的

> 几个进程能并发执行同一程序；同一进程能顺序执行几个程序

类Unix操作系统采用进程/内核模式，只有内核同意程序的硬件申请，才会将特权模式由用户态转变为内核态。

### 5. 内核体系结构

大部分内核是单块结构，每一个内核层都被集成到整个内核程序中，并代表当前进程在内核态下运行，具有简单/高性能的特点；微内核将系统服务层剥离出来。

Linux 引入 模块（module）概念

> 模块为一个目标文件，其代码可以运行时链接到内核或解除链接（动态加载内核模块）

### 6. Unix 文件系统概述

Unix 文件是以字节序列组成的信息载体。文件被组织在一个树结构的命名空间中。除了叶节点之外，树中其他节点都为目录。

文件名通常不超过255字符

Unix的每一个进程都有一个当前工作目录，属于进程执行上下文，表示出进程所用的当前目录。



### 7. 硬链接和软连接

包含在目录中的 **文件名** 就是一个文件的硬链接，硬链接直接指向文件数据的所在位置，限制：

1. 用户不允许给目录创建硬链接
2. 同一文件系统才能创建链接

软连接没有以上限制，本质是一种包含另一文件或目录的路径名



### 8. 文件类型

- 普通文件
- 目录
- 符号链接
- 面向块的设备文件
- 面向字符的设备文件
- 管道
- 套接字 socket



### 9. 文件描述符

Unix 对文件内容和描述文件的信息给出了清楚的区分。



## Unix 内核概述

### 进程/内核模式

一个程序执行时，大部分时间都在用户态下，当需要使用内核服务才会切换到内核模式，使用完毕后又会切换回用户态。该模式假定请求内核服务的进程使用 (system call) 

### 进程实现

每个进程由 **进程描述符** 表示，其中包含进程当前状态信息（包含栈指针和 线程暂停后的cpu寄存器信息）

### 可重入内核

多个进程可以同时在内核态下执行。

> 可重入函数： 只能修改局部变量，不能修改全局数据结构的函数

**内核控制路径**： 表示内核处理系统调用、异常或中断所执行的指令序列

cpu交错执行内核控制路径：

* 当前路径无法立即执行
* 检测到异常
* 硬件中断发生
* 抢占式内核调度发生

### 进程地址空间

每个进程运行在私有地址空间，在用户态下有：私有栈、数据区、代码区；内核态下，使用另外的私有栈。

进程之间可以共享部分地址空间。

### 同步和临界区

多个线程数据竞争，

> 临界区：一段进入就必须完成的代码

解决方案：

#### 1. 非抢占式内核

进程在内核态执行时，不能被任意挂起，故访问数据安全。

#### 2. 禁止中断

#### 3. 信号量

组成：

1. 一个整数变量
2. 一个等待进程链表
3. 原子方法对信号量操作

如果不允许访问时，将进程加入信号量等待链表进行阻塞

#### 4. 自旋锁

　自旋锁是一种对临界资源进行互斥访问的手段，获得锁的的任务能对临界进行操作，操作完后解锁，没有获得锁的任务则循环等待锁可用，相当于原地打转自旋。Linux 自旋锁采用的是 排队取号机制，让cpu线程间避免无序竞争。

#### 5. 避免死锁

### 信号和进程间通信

Unix信号 提供了把系统事件报告给进程的机制，进程可以以两种方式对接收到的信号进行反应：

- 忽略
- 异步执行执行过程

### 进程管理

### 进程组和登录会话

### 内存管理



